#!/usr/bin/env sh

TEMPLATES_URL="https://www.toptal.com/developers/gitignore/api/list"
GEN_URL="https://www.gitignore.io/api"

get_templates() {
	curl -fsSL "$TEMPLATES_URL" | tr ',' '\n'
}

select_template() {
	printf '%s\n' "$1" | fzf --multi || return 1
}

get_ignore_file() {
	curl -fsSL "${GEN_URL}/$1"
}

export_file() {
	printf '%s' "$1" >.gitignore
	echo "Imported .gitignore into current directory"
}

main() {
	templates="$(get_templates)" || {
		echo "Error: Failed to fetch template list." >&2
		exit 1
	}

	[ -n "$templates" ] || {
		echo "Error: No templates received." >&2
		exit 1
	}

	selected="$(select_template "$templates")" || {
		echo "No template selected. Exiting."
		exit 0
	}

	ignore_data="$(get_ignore_file "$selected")" || {
		echo "Error: Failed to fetch .gitignore data." >&2
		exit 1
	}

	export_file "$ignore_data"
}

main
