#!/usr/bin/env sh

set -e

VIDEOS_DIR="/home/bryant/Videos/"
RECORDINGS_DIR="/run/media/bryant/tiagovault/videos/"
ROFI_CMD='rofi -dmenu -i'

list_dirs() {
	fd . --type=d --max-depth 1 "$VIDEOS_DIR" "$RECORDINGS_DIR" 2>/dev/null
}

list_files_in_dir() {
	fd --base-directory "$1" \
		--glob '*.{mp4,mkv,avi,mov,m4v,webm,flv,wmv,mpeg,mpg}' \
		2>/dev/null
}

select_dir() {
	printf '%s\n' "$1" | $ROFI_CMD -p "Select directory"
}

select_file() {
	printf '%s\n' "$1" | $ROFI_CMD -p "Select file"
}

play() {
	exec mpv "$1"
}

main() {
	dirs=$(list_dirs)
	[ -n "$dirs" ] || exit 1

	selected_dir=$(select_dir "$dirs")
	[ -n "$selected_dir" ] || exit 1
	[ -d "$selected_dir" ] || exit 1

	files=$(list_files_in_dir "$selected_dir")
	[ -n "$files" ] || exit 1

	selected_file=$(select_file "$files")
	[ -n "$selected_file" ] || exit 1

	case "$selected_dir" in
	*/) full_path="${selected_dir}${selected_file}" ;;
	*) full_path="${selected_dir}/${selected_file}" ;;
	esac

	[ -f "$full_path" ] || exit 1

	play "$full_path"
}

main
