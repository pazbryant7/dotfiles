#!/bin/env sh

LOCK_FILE="/tmp/screenkey.lock"

lock_descriptor() {
	exec 9>"$LOCK_FILE"
}

execute_screen_key() {
	screenkey --geometry 360x600+1540+490 \
		--opacity 0.4 \
		--font "Annotation Mono 25" &

	flock 9
}

stop_screen_key() {
	killall screenkey 2>/dev/null
}

lock_available() {
	flock -n 9
}

main() {
	lock_descriptor || exit 1

	if lock_available; then
		execute_screen_key # only executes is lock is not held by a previous execution
	else
		stop_screen_key
	fi
}

main "$@"
