#!/usr/bin/env sh
# Switch between opened tmux sessions

tmux_is_running() {
	pgrep tmux >/dev/null
}

get_current_session() {
	tmux display-message -p '#S'
}

select_session() {
	tmux list-sessions | awk -F ':' '{print $1}' | fzf | sort
}

session_exists() {
	tmux has-session -t="$1" 2>/dev/null
}

main() {
	if [ -z "$TMUX" ] && ! tmux_is_running; then
		exit 0
	fi

	selected=$(select_session)
	[ -z "$selected" ] && exit 0

	current=$(get_current_session)

	if [ "$current" = "$selected" ]; then
		tmux display-message "Already attached to this session."
		exit 1
	fi

	if ! session_exists "$selected"; then
		tmux display-message "Session no longer exists."
		exit 1
	fi

	tmux switch-client -t "$selected"
}

main "$@"
