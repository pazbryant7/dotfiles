#!/bin/env sh

case "$1" in
"")
	selection=$(fd . \
		--max-depth 1 \
		--type=d \
		--type=l \
		--follow \
		"$HOME/Documents/github/" \
		"$HOME/Documents/github/temp" \
		"$HOME/Downloads/" 2>/dev/null | fzf)
	;;
"working")
	selection=$(tmux display-message -p '#{pane_current_path}')
	;;
*)
	selection="$1"
	;;
esac

if [ -z "$selection" ]; then
	exit 0
fi

if [ "$1" = "working" ]; then
	session_name="working"
else
	session_name=$(basename "$selection" | tr . _)
fi

if [ -n "$TMUX" ]; then
	current_session=$(tmux display-message -p '#S')
	if [ "$current_session" = "$session_name" ]; then
		tmux display-message "Already attached to session: $session_name"
		exit 0
	elif [ -n "$2" ]; then
		tmux kill-session -t working
	fi
fi

if ! tmux has-session -t="$session_name" 2>/dev/null; then
	tmux new-session -ds "$session_name" -c "$selection"
fi

if [ -n "$TMUX" ]; then
	tmux switch-client -t "$session_name"
else
	tmux attach-session -t "$session_name"
fi
