#!/usr/bin/env sh
# Remove all panes in current window except the current pane

get_current_pane() {
	tmux display-message -p '#{pane_id}'
}

get_current_window() {
	tmux display-message -p '#{window_index}'
}

get_window_panes() {
	window="$1"
	tmux list-panes -t "$window" -F '#{pane_id}'
}

is_inside_tmux() {
	[ -n "$TMUX" ]
}

kill_other_panes() {
	window="$1"
	current_pane="$2"

	get_window_panes "$window" | while read -r pane_id; do
		if [ "$pane_id" != "$current_pane" ]; then
			tmux kill-pane -t "$pane_id"
		fi
	done
}

main() {
	if ! is_inside_tmux; then
		printf "Error: not inside a tmux session\n" >&2
		exit 1
	fi

	current=$(get_current_pane)
	window=$(get_current_window)
	kill_other_panes "$window" "$current"
}

main "$@"
