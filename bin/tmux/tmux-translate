#!/usr/bin/env sh
# Fast and simple tmux translator (Spanish <-> English)
# Requirements: translate shell from `soimort`

TRANSLATE_OPTS="-verbose -no-warn -speak"

is_valid_direction() {
	case "$1" in
	"en:es" | "es:en")
		return 0
		;;
	*)
		return 1
		;;
	esac
}

get_direction_message() {
	case "$1" in
	"en:es")
		printf "Translating from English to Spanish"
		;;
	"es:en")
		printf "Translating from Spanish to English"
		;;
	esac
}

translate() {
	direction="$1"
	text="$2"
	tmux neww sh -c "trans $TRANSLATE_OPTS $direction '$text'; echo; echo; echo '⚡⚡⚡⚡⚡'; read -n 1"
}

read_query() {
	IFS= read -r query
	printf '%s' "$query"
}

main() {
	direction="$1"

	if ! is_valid_direction "$direction"; then
		printf "Error: Invalid direction. Use 'en:es' or 'es:en'.\n" >&2
		exit 1
	fi

	while true; do
		printf '%s\n\n' "$(get_direction_message "$direction")"
		query=$(read_query)

		if [ -z "$query" ]; then
			printf "\nNo text entered. Exiting.\n"
			exit 0
		fi

		translate "$direction" "$query"

		printf '\n(r)etranslate or (q)uit? '
		IFS= read -r choice
		case "$choice" in
		q | Q)
			exit 0
			;;
		r | R)
			continue
			;;
		*)
			continue
			;;
		esac
	done
}

main "$@"
