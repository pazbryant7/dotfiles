# ~/.tmux.conf

# -----------------------------------------------------------------------------
# General Settings
# -----------------------------------------------------------------------------
# Set prefix key to C-a
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# Set base index for windows and panes to 1
set-option -g base-index 1
set-window-option -g pane-base-index 1

# Set history limit
set-option -g history-limit 5000

# Reduce delay after prefix key
set-option -s escape-time 0

# Enable mouse mode
set-option -g mouse on

# Enable focus events (useful for Neovim)
set-option -g focus-events on

# Set terminal compatibility and enable true color
set-option -g default-terminal "tmux-256color"
set-option -g terminal-overrides ',xterm-256color:Tc'
set-option -ga terminal-overrides ',xterm-256color:Tc'

# Scroll setup
bind-key -n M-k if-shell -F "#{pane_in_mode}" \
  "send-keys -X -N 5 scroll-up" \
  "copy-mode -e \; send-keys -X -N 5 scroll-up"

bind-key -T copy-mode-vi M-k send-keys -X -N 5 scroll-up

bind-key -n M-j if-shell -F "#{pane_in_mode}" \
  "send-keys -X -N 5 scroll-down" \
  "copy-mode -e \; send-keys -X -N 5 scroll-down"

bind-key -T copy-mode-vi M-j send-keys -X -N 5 scroll-down

# Yazi file manager specific settings
set-option -g visual-activity off
set-option -g allow-passthrough on
set-option -ga update-environment TERM # Append TERM to update-environment

# -----------------------------------------------------------------------------
# Appearance & Status Bar
# -----------------------------------------------------------------------------

# Enable status bar and set position
set-option -g status on
set-option -g status-position bottom

# Enable titles
set-option -g set-titles on
set -g set-titles-string '#{=5:pane_title}'

# Status bar style
set-option -g status-style 'bg=#1e1e2e,fg=#3BA4A5'

# Status bar content alignment and lengths
set-option -g status-left-length 50
set-option -g status-right-length 50
set-option -g status-justify 'absolute-centre'

# Status bar left side: Session name
set-option -g status-left '#S#[fg=#616161]#{S:#{?session_attached,, #S}}'

# Status bar center: Window list format
set-option -g window-status-current-format '#{pane_title}'

# Status bar right side: Current path
set-option -g status-right '%b %d %H:%M'

# Pane border style
set-option -g pane-border-lines simple

# Time panes are displayed when using display-panes command (in ms)
set-option -g display-panes-time 5000

# -----------------------------------------------------------------------------
# Keybindings
# -----------------------------------------------------------------------------
# Note: Default tmux bindings might be overwritten below

# Refresh tmux client
bind-key r run-shell "tmux refresh-client && tmux display-message 'Client Refreshed'"

# Reload tmux configuration
bind-key R source-file ~/.tmux.conf \; display-message "Configuration Reloaded"

# --- Navigation ---

# Vim-like pane navigation
bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R
bind-key \\ select-pane -l
bind-key ^ last-window

# Chosee tree
bind-key S choose-tree -s

# --- Window & Pane Management ---

# Create new window in the current path
bind-key c new-window -c "#{pane_current_path}"

# Split panes vertically in the current path
bind-key % split-window -h -c "#{pane_current_path}"

# Split panes horizontally in the current path
bind-key '"' split-window -v -c "#{pane_current_path}" # Use -v for vertical consistency

# Close window/pane (using custom script)
bind-key x run-shell "~/bin/tmux/close-window"
bind-key X run-shell "~/bin/tmux/close-all-windows"


# Kill the current session (using custom script)
bind-key k run-shell "~/bin/tmux/remove-all"
bind-key K run-shell "~/bin/tmux/remove-all bryant"

# --- Copy Mode (Vi-like) ---

set-window-option -g mode-keys vi
bind-key v copy-mode
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'xclip -in -selection clipboard'

# --- Custom Actions & Scripts ---

# Show clock cunnet panel
bind-key T clock-mode

# Toggle status bar visibility
bind-key b set-option -g status

# Session switching (using custom scripts)
bind-key s run-shell "~/bin/tmux/switch-session"
bind-key o run-shell "tmux neww ~/bin/global/gsa"
bind-key u run-shell "tmux neww ~/bin/tmux/new-session"
bind-key U run-shell "tmux neww ~/bin/tmux/select-session"

# Translation utility (using custom script)
bind-key e run-shell "tmux neww ~/bin/tmux/translate 'en:es'"
bind-key E run-shell "tmux neww ~/bin/tmux/translate 'es:en'"

# Manage working session
bind-key W run-shell "~/bin/tmux/new-session '#{pane_current_path}' working"
bind-key Enter run-shell "~/bin/tmux/new-session '#{pane_current_path}' working nuke"
bind-key t new-window -n Todo -c "#{pane_current_path}" "cd ~/Documents/github/notes && nvim todo.md" # Open notes

# Switch/create sessions in specific directories (using custom scripts)
bind-key H run-shell "~/bin/tmux/new-session /home/bryant"
bind-key V run-shell "~/bin/tmux/new-session /home/bryant/.config/vim"
bind-key N run-shell "~/bin/tmux/new-session /home/bryant/.config/nvim"
bind-key G run-shell "~/bin/tmux/new-session /home/bryant/Documents/github"
bind-key Y run-shell "~/bin/tmux/new-session /home/bryant/Documents/github/youtube"
bind-key D run-shell "~/bin/tmux/new-session /home/bryant/Documents/github/dotfiles"

# -----------------------------------------------------------------------------
# End of Configuration
# -----------------------------------------------------------------------------
